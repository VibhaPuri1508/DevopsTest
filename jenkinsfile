pipeline{
   agent any
   tools {
        maven "MAVEN"
        jdk "JDK"
    }
    triggers{
     cron(' 0 06 * * * ')
    } 
    stages{
     stage("code build"){
         steps{
          bat "mvn clean package -DskipTest=true"
       }
     }
    stage("code test"){
         steps{
          bat "mvn clean test"
       }
     }
    stage("sonarqube analysis "){
         steps{
         bat "mvn sonar:sonar -Dsonar.token=sqa_2b9abeaf77f78ed9826e2e0590d8ffda21bab02f"
       }
     }
    stage("publish to artifactory"){
         steps{
           rtMavenDeployer(
            id: 'deployer',
            serverId: 'NagpDevopsArtifactory',
            releaseRepo: 'NagpDevopsRepository',
            snapshotRepo:  'NagpDevopsRepository'
          )
          rtMavenRun(
            pom: 'pom.xml',
            goals: 'clean install',
            deployerId: 'deployer'
         )
         rtPublishBuildInfo(
           serverId: 'NagpDevopsArtifactory',
         )
       }
     }
  }
  post{
      success {
      bat "echo success"
     }
  }

}
